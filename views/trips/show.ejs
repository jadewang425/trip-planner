<%- include('../partials/header') %>
<section class="show-trip-details">
    <div><%= trip.tripStartDate.toLocaleDateString() %> - <%= trip.tripEndDate.toLocaleDateString() %></div>
    <div><%= trip.tripDesc %></div>
    <% if(trip.owner) {%>
        <div><strong>Created by: </strong></div>
        <div><%= trip.owner.name %></div>
    <% } %>
    <div><strong>Participants:</strong></div>
    <div><%= trip.members %></div>
    <div><strong>Tasks:</strong></div>
    <% if (trip.tasks.length) { %>
        <ul>
            <% trip.tasks.forEach(task => { %>
                <li><%= task.item %> - <small><%= task.createdAt.toLocaleDateString() %></small></li>
            <% }) %>
        </ul>
    <% } else { %>
        <h6>No Tasks Added Yet</h6>
    <% } %>
    <% if (trip.owner?._id.equals(user?._id)) { %>
        <!-- add task form -->
        <form action="/tasks/<%= trip._id%>" method="POST">
            <label>Add A Task</label>
            <input type="text" name="item">
            <input type="submit" value="Add Task">
        </form>
        <div class="trip-update-btns">
            <a href="/trips/<%= trip._id %>/edit">
                Edit Trip
            </a>
            <form action="/trips/<%= trip._id %>?_method=DELETE" method="POST">
                <input type="submit" value="Delete"></input>
            </form>
            <% } %>
        </div> 
</section>
<hr>
<!-- comments form  -->
<% if (user) { %>
    <form action="/comments/<%= trip._id%>" method="POST" class="col-md-6 offset-md-3">
        <fieldset>
            <h5>Add Comment</h5>
            <label class="form-label">Comment: </label>
            <input type="text" name="comment">
            <input type="submit" class="btn btn-info" value="Add Comment">
        </fieldset>
    </form>
<% }%>
<!-- comments section -->
<h5>Comments</h5>
<section>
    <% if (trip.comments.length) { %>
        <table class="table">
            <tbody >
                <% trip.comments.forEach(comment => { %>
                <tr class="card shadow comments-layout">
                    <td class="col"><img src="<%= comment.author.avatar %>"></td>
                    <td class="col"><strong><%= comment.author.name %></strong></td>
                    <td class="col"><%= comment.comment %> - 
                    <small><%= comment.createdAt.toLocaleDateString() %></small></td>
                <% }) %>
                </tr>
            </tbody>
        </table>
    <% } else { %>
        <h6>No Comments Yet</h6>
    <% } %>
</section>

<%- include('../partials/footer') %>